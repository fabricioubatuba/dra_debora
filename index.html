<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Gerador de Documentos - Débora Castilho</title>

<!-- PDFMake -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>

<style>
  :root{
    --bg:#f4f6f8;
    --card:#ffffff;
    --accent:#063852; /* azul petróleo */
    --muted:#6b6f72;
    --soft:#f2f4f6;
  }
  *{box-sizing:border-box;font-family:Inter, "Segoe UI", Roboto, Arial, Helvetica, sans-serif}
  body{background:var(--bg);margin:0;padding:28px;color:#1b2430}
  .wrap{max-width:1100px;margin:0 auto}
  .card{background:var(--card);border-radius:12px;padding:18px;box-shadow:0 8px 30px rgba(8,20,30,0.06)}
  header.top{display:flex;align-items:center;gap:16px;margin-bottom:12px}
  header .brand{display:flex;align-items:center;gap:12px}
  header img.logo{height:56px}
  header h1{font-size:18px;margin:0;color:var(--accent)}
  .tabs{display:flex;gap:6px;margin:14px 0;flex-wrap:wrap}
  .tab{padding:8px 12px;border-radius:8px;background:var(--soft);cursor:pointer;font-weight:700;color:var(--accent)}
  .tab.active{background:linear-gradient(180deg,#063852,#0b5065);color:#fff}

  form.section{display:none;margin-top:12px}
  form.section.active{display:block}
  .grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
  .full{grid-column:1 / -1}
  label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px;font-weight:600}
  input[type=text], input[type=email], input[type=date], select, textarea, input[type=number] {width:100%;padding:10px;border-radius:8px;border:1px solid #e3e7ea;background:#fff;font-size:14px}
  textarea{min-height:120px}
  .small{font-size:13px;color:var(--muted)}
  .actions{display:flex;gap:8px;justify-content:flex-end;margin-top:12px}
  button{padding:10px 14px;border-radius:8px;border:none;cursor:pointer;font-weight:700}
  .btn-primary{background:var(--accent);color:#fff}
  .btn-muted{background:#f6f8f9;color:var(--accent);border:1px solid #e7ebee}
  .preview{border:1px solid #e9eef2;border-radius:8px;padding:14px;background:#fff;min-height:260px;white-space:pre-wrap}
  .footer-note{margin-top:14px;font-size:13px;color:var(--muted);text-align:center}
  
  /* Modal */
  .modal{display:none;position:fixed;z-index:1000;left:0;top:0;width:100%;height:100%;background-color:rgba(0,0,0,0.5)}
  .modal-content{background-color:#fff;margin:15% auto;padding:20px;border-radius:8px;width:90%;max-width:400px;box-shadow:0 4px 20px rgba(0,0,0,0.15)}
  .modal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:15px}
  .modal-header h2{margin:0;color:var(--accent)}
  .close{color:#aaa;font-size:28px;font-weight:bold;cursor:pointer}
  .close:hover{color:#000}
  .modal-body input{width:100%;padding:10px;margin-bottom:15px;border-radius:8px;border:1px solid #e3e7ea}
  .modal-footer{display:flex;justify-content:flex-end;gap:10px}
  
  /* Bloqueio de conteúdo */
  .content-blocked{display:none}
  
  @media(max-width:900px){.grid{grid-template-columns:1fr}}
</style>
</head>
<body>
<!-- Modal de Login -->
<div id="loginModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h2>Acesso Restrito</h2>
      <span class="close">&times;</span>
    </div>
    <div class="modal-body">
      <input type="email" id="loginEmail" placeholder="E-mail" />
      <input type="password" id="loginPassword" placeholder="Senha" />
    </div>
    <div class="modal-footer">
      <button class="btn-muted" id="loginBtn">Entrar</button>
    </div>
  </div>
</div>

<div class="wrap">
  <div class="card">
    <header class="top">
      <div class="brand">
        <!-- site logo (visible no site) -->
        <img class="logo" id="pageLogo" src="" alt="logo" />
        <div>
          <h1>Gerador de Documentos — Escritório Jurídico</h1>
          <div class="small">Produza Procuração • Declaração de Pobreza • Contrato de Honorários</div>
        </div>
      </div>

      <div style="margin-left:auto;text-align:right">
        <div class="small">Débora Castilho</div>
        <button class="btn-muted" id="logoutBtn" style="display:none;margin-top:5px;">Sair</button>
      </div>
    </header>

    <div id="mainContent" class="content-blocked">
      <nav class="tabs" role="tablist">
        <div class="tab active" data-tab="dados">Dados do Contratante</div>
        <div class="tab" data-tab="procuracao">Procuração</div>
        <div class="tab" data-tab="declaracao">Declaração de Pobreza</div>
        <div class="tab" data-tab="contrato">Contrato de Honorários</div>
      </nav>

      <!-- DADOS DO CONTRATANTE -->
      <form id="form-dados" class="section active" onsubmit="return false">
        <div class="grid">
          <div>
            <label>Contratante</label>
            <input type="text" id="contratante" placeholder="Nome completo" />
          </div>

          <div>
            <label>Nacionalidade</label>
            <!-- NÃO é select: editável, valor padrão 'brasileiro(a)' -->
            <input type="text" id="nacionalidade" value="brasileiro(a)" />
          </div>

          <div>
            <label>Estado Civil</label>
            <select id="estadoCivil"><option>Solteiro(a)</option><option>Casado(a)</option><option>Divorciado(a)</option><option>Viúvo(a)</option><option>União Estável</option></select>
          </div>

          <div>
            <label>Profissão</label>
            <input type="text" id="profissao" />
          </div>

          <div>
            <label>RG</label>
            <input type="text" id="rg" />
          </div>

          <div>
            <label>CPF / CNPJ</label>
            <input type="text" id="cpfCnpj" placeholder="CPF ou CNPJ" />
          </div>

          <div class="full">
            <label>Endereço</label>
            <input type="text" id="endereco" />
          </div>

          <div>
            <label>Número</label>
            <input type="text" id="numero" />
          </div>

          <div>
            <label>Complemento</label>
            <input type="text" id="complemento" />
          </div>

          <div>
            <label>Bairro</label>
            <input type="text" id="bairro" />
          </div>

          <div>
            <label>CEP</label>
            <input type="text" id="cep" placeholder="11695-738" />
          </div>

          <div>
            <label>E-mail</label>
            <input type="email" id="email" />
          </div>

          <div>
            <label>Data</label>
            <input type="date" id="data" />
          </div>
        </div>

        <div class="actions">
          <button class="btn-muted" id="salvarDadosBtn">Salvar</button>
        </div>
      </form>

      <!-- PROCURAÇÃO -->
      <form id="form-procuracao" class="section" onsubmit="return false">
        <div class="grid">
          <div class="full">
            <label>Finalidade da Procuração</label>
            <!-- caixa reduzida (duas linhas) e pré-carregada -->
            <textarea id="finalidadeProc" rows="2"></textarea>
          </div>

          <div class="full">
            <label>Simulação do documento</label>
            <div id="preview-procuracao" class="preview"></div>
          </div>
        </div>
        <div class="actions">
          <button class="btn-primary" id="pdfProcuracaoBtn">Criar PDF</button>
        </div>
      </form>

      <!-- DECLARAÇÃO -->
      <form id="form-declaracao" class="section" onsubmit="return false">
        <div class="grid">
          <div class="full">
            <label>Simulação do documento</label>
            <div id="preview-declaracao" class="preview"></div>
          </div>
        </div>
        <div class="actions">
          <button class="btn-primary" id="pdfDeclaracaoBtn">Criar PDF</button>
        </div>
      </form>

      <!-- CONTRATO DE HONORÁRIOS -->
      <form id="form-contrato" class="section" onsubmit="return false">
        <div class="grid">
          <div>
            <label>Motivo da Ação</label>
            <input type="text" id="c_motivoAcao" value="DANOS MORAIS E MATERIAIS" />
          </div>

          <div>
            <label>% Pro-labore</label>
            <input type="text" id="c_proLabore" value="30%" />
          </div>

          <div>
            <label>Valor Propositura</label>
            <input type="text" id="c_valorPropositura" placeholder="R$ 1.500,00" value="R$ 1.500,00" />
          </div>

          <div>
            <label>Qtd de Parcelas</label>
            <input type="number" id="c_qtdParcelas" min="1" value="5" />
          </div>

          <div>
            <label>Valor da Parcela</label>
            <input type="text" id="c_valorParcela" placeholder="R$ 0,00" />
          </div>

          <div>
            <label>1º Vencimento</label>
            <input type="date" id="c_primeiroVencimento" />
          </div>

          <div class="full">
            <label>Simulação do documento</label>
            <div id="preview-contrato" class="preview"></div>
          </div>
        </div>

        <div class="actions">
          <button class="btn-primary" id="pdfContratoBtn">Criar PDF</button>
        </div>
      </form>

      <div class="footer-note">...</div>
    </div>
  </div>
</div>

<script>
console.log("SCRIPT INICIADO");

/* =======================
   Firebase Authentication
   ======================= */
const firebaseConfig = {
  apiKey: "AIzaSyD26PRNiwL8oiytAw5A5TxdiNfArZwPanM",
  authDomain: "indicacao-830b9.firebaseapp.com",
  databaseURL: "https://indicacao-830b9-default-rtdb.firebaseio.com",
  projectId: "indicacao-830b9",
  storageBucket: "indicacao-830b9.firebasestorage.app",
  messagingSenderId: "909425678755",
  appId: "1:909425678755:web:0be8effae0195223cae216"
};

// Inicializar Firebase
firebase.initializeApp(firebaseConfig);

// Referências do DOM para autenticação
const loginModal = document.getElementById('loginModal');
const loginBtn = document.getElementById('loginBtn');
const logoutBtn = document.getElementById('logoutBtn');
const mainContent = document.getElementById('mainContent');
const closeModal = document.querySelector('.close');

// Verificar estado de autenticação
firebase.auth().onAuthStateChanged((user) => {
  if (user) {
    // Usuário logado
    loginModal.style.display = 'none';
    mainContent.style.display = 'block';
    logoutBtn.style.display = 'block';
  } else {
    // Usuário não logado
    loginModal.style.display = 'block';
    mainContent.style.display = 'none';
    logoutBtn.style.display = 'none';
  }
});

// Login
loginBtn.addEventListener('click', () => {
  const email = document.getElementById('loginEmail').value;
  const password = document.getElementById('loginPassword').value;
  
  firebase.auth().signInWithEmailAndPassword(email, password)
    .then((userCredential) => {
      // Login bem-sucedido
      console.log('Usuário logado:', userCredential.user);
    })
    .catch((error) => {
      alert('Erro no login: ' + error.message);
    });
});

// Logout
logoutBtn.addEventListener('click', () => {
  firebase.auth().signOut();
});

// Fechar modal
closeModal.addEventListener('click', () => {
  loginModal.style.display = 'none';
});

// Fechar modal ao clicar fora
window.addEventListener('click', (event) => {
  if (event.target === loginModal) {
    loginModal.style.display = 'none';
  }
});

/* =======================
   Configurações de logo
   ======================= */
/* As URLs que você informou */
const headerLogoUrl = "https://raw.githubusercontent.com/fabricioubatuba/dra_debora/refs/heads/main/logo_dc_novo.png";
const siteLogoUrl = "https://raw.githubusercontent.com/fabricioubatuba/dra_debora/refs/heads/main/logo_dc_novo_site.png";

/* Exibe logo do site (visível no HTML) */
document.getElementById('pageLogo').src = siteLogoUrl;

/* variavel que conterá a imagem convertida para base64 (usada no cabeçalho do PDF) */
let logoDataUrl = null;

/* Puxa a imagem do GitHub e converte para dataURL para PDFMake */
async function loadHeaderLogo() {
  try {
    const resp = await fetch(headerLogoUrl);
    if (!resp.ok) { console.warn('Logo do header não encontrada'); return; }
    const blob = await resp.blob();
    logoDataUrl = await blobToDataURL(blob);
    console.info('Logo de cabeçalho carregada.');
  } catch (e) {
    console.warn('Erro ao carregar logo do header', e);
  }
}
function blobToDataURL(blob){
  return new Promise((resolve) => {
    const r = new FileReader();
    r.onload = () => resolve(r.result);
    r.readAsDataURL(blob);
  });
}
loadHeaderLogo();

/* =======================
   Controle de abas
   ======================= */
document.querySelectorAll('.tab').forEach(tab => {
  tab.addEventListener('click', function() {
    // Remove classe active de todas as abas
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    // Adiciona classe active na aba clicada
    this.classList.add('active');
    
    // Esconde todos os formulários
    document.querySelectorAll('form.section').forEach(form => {
      form.classList.remove('active');
    });
    
    // Mostra o formulário correspondente
    const tabId = this.getAttribute('data-tab');
    document.getElementById(`form-${tabId}`).classList.add('active');
  });
});

/* =======================
   Máscaras e utilitários
   ======================= */

/* Formatar CEP: 11695-738 */
function formatCEP(v) {
  v = v.replace(/\D/g,'').slice(0,8);
  if (v.length > 5) return v.slice(0,5) + '-' + v.slice(5);
  if (v.length > 0) return v;
  return v;
}

/* CPF/CNPJ: altera máscara conforme comprimento */
function formatCpfCnpj(v) {
  v = v.replace(/\D/g,'');
  if (v.length <= 11) {
    // CPF: XXX.XXX.XXX-XX
    v = v.replace(/(\d{3})(\d)/,'$1.$2');
    v = v.replace(/(\d{3})(\d)/,'$1.$2');
    v = v.replace(/(\d{3})(\d{1,2})$/,'$1-$2');
  } else {
    // CNPJ: XX.XXX.XXX/XXXX-XX
    v = v.replace(/^(\d{2})(\d)/,'$1.$2');
    v = v.replace(/^(\d{2})\.(\d{3})(\d)/,'$1.$2.$3');
    v = v.replace(/\.(\d{3})(\d)/,'.$1/$2');
    v = v.replace(/(\d{4})(\d{1,2})$/,'$1-$2');
  }
  return v;
}

/* Formatar moeda no campo (R$ 1.500,00) — entrada apenas números */
function formatarMoedaInputString(v) {
  v = v.replace(/\D/g,'');
  if (!v) return '';
  v = (parseInt(v,10)/100).toFixed(2) + '';
  v = v.replace('.',',');
  v = v.replace(/\B(?=(\d{3})+(?!\d))/g, '.'); // milhares
  return 'R$ ' + v;
}

/* recebe string no formato 'R$ 1.500,00' e retorna number */
function moedaToNumber(str) {
  if (!str) return 0;
  str = str.replace(/[R$\s\.]/g,'').replace(',','.');
  const n = parseFloat(str);
  return isNaN(n) ? 0 : n;
}

/* =======================
   Número por extenso (simples) — trata até centenas de milhares
   retorna algo como 'mil e quinhentos reais' ou 'um real e cinquenta centavos' */
function numeroParaExtensoSimples(numero) {
  numero = parseInt(numero,10);
  if (isNaN(numero)) return '';
  const unidades = ['','um','dois','três','quatro','cinco','seis','sete','oito','nove'];
  const de10a19 = ['dez','onze','doze','treze','quatorze','quinze','dezesseis','dezessete','dezoito','dezenove'];
  const dezenas = ['','','vinte','trinta','quarenta','cinquenta','sessenta','setenta','oitenta','noventa'];
  const centenas = ['','cem','duzentos','trezentos','quatrocentos','quinhentos','seiscentos','setecentos','oitocentos','novecentos'];

  function até999(n) {
    if (n === 0) return 'zero';
    if (n === 100) return 'cem';
    let s = '';
    const c = Math.floor(n/100);
    const resto = n%100;
    if (c>0) s += centenas[c];
    if (resto>0 && c>0) s += ' e ';
    if (resto>=10 && resto<=19) s += de10a19[resto-10];
    else {
      const d = Math.floor(resto/10);
      const u = resto%10;
      if (d>1) { s += dezenas[d]; if (u>0) s += ' e ' + unidades[u]; }
      else if (u>0) s += unidades[u];
    }
    return s;
  }

  if (numero < 1000) return até999(numero);
  if (numero < 1000000) {
    const milhares = Math.floor(numero/1000);
    const resto = numero%1000;
    let s = '';
    if (milhares === 1) s = 'mil';
    else s = até999(milhares) + ' mil';
    if (resto > 0) s += (resto < 100 ? ' e ' : ' ') + até999(resto);
    return s;
  }
  return String(numero);
}

function valorParaExtenso(valorStr) {
  if (!valorStr) return '';
  // valorStr esperado 'R$ 1.500,00' ou '1500,00'
  let n = moedaToNumber(valorStr);
  if (isNaN(n)) return '';
  const inteiro = Math.floor(n);
  const cent = Math.round((n - inteiro) * 100);
  let parte = numeroParaExtensoSimples(inteiro) + (inteiro === 1 ? ' real' : ' reais');
  if (cent > 0) parte += ' e ' + numeroParaExtensoSimples(cent) + (cent === 1 ? ' centavo' : ' centavos');
  return parte;
}

/* =======================
   Validação de campos obrigatórios
   ======================= */

function validarCamposObrigatorios(tipo) {
  const camposObrigatorios = {
    dados: ['contratante', 'nacionalidade', 'estadoCivil', 'profissao', 'rg', 'cpfCnpj', 'endereco', 'numero', 'bairro', 'cep', 'data'],
    procuracao: ['contratante', 'nacionalidade', 'estadoCivil', 'profissao', 'rg', 'cpfCnpj', 'endereco', 'numero', 'bairro', 'cep', 'data', 'finalidadeProc'],
    declaracao: ['contratante', 'nacionalidade', 'estadoCivil', 'profissao', 'rg', 'cpfCnpj', 'endereco', 'numero', 'bairro', 'cep', 'data'],
    contrato: ['contratante', 'nacionalidade', 'estadoCivil', 'profissao', 'rg', 'cpfCnpj', 'endereco', 'numero', 'bairro', 'cep', 'data', 'c_motivoAcao', 'c_proLabore', 'c_valorPropositura', 'c_qtdParcelas', 'c_valorParcela', 'c_primeiroVencimento']
  };

  const campos = camposObrigatorios[tipo] || [];
  const camposFaltantes = [];

  for (const campoId of campos) {
    const campo = document.getElementById(campoId);
    if (campo && !campo.value.trim()) {
      camposFaltantes.push(campoId);
    }
  }

  if (camposFaltantes.length > 0) {
    alert(`Por favor, preencha todos os campos obrigatórios antes de gerar o PDF.\nCampos faltantes: ${camposFaltantes.join(', ')}`);
    return false;
  }

  return true;
}

/* =======================
   Eventos: máscaras, cálculos e previews
   ======================= */

document.getElementById('cep').addEventListener('input', e => {
  e.target.value = formatCEP(e.target.value);
});

document.getElementById('cpfCnpj').addEventListener('input', e => {
  const pos = e.target.selectionStart;
  const cur = e.target.value;
  e.target.value = formatCpfCnpj(cur);
});

document.getElementById('c_valorPropositura').addEventListener('input', e => {
  e.target.value = formatarMoedaInputString(e.target.value);
  atualizarValorParcelaAutomatico();
  atualizarPreviewContrato();
});
document.getElementById('c_qtdParcelas').addEventListener('input', () => { atualizarValorParcelaAutomatico(); atualizarPreviewContrato(); });
document.getElementById('c_valorParcela').addEventListener('input', e => {
  e.target.value = formatarMoedaInputString(e.target.value);
  atualizarPreviewContrato();
});

/* calcula automaticamente o valor da parcela e coloca no campo valorParcela */
function atualizarValorParcelaAutomatico() {
  const total = moedaToNumber(document.getElementById('c_valorPropositura').value);
  const qtd = parseInt(document.getElementById('c_qtdParcelas').value) || 1;
  if (total <= 0 || qtd <= 0) return;
  const parcela = total / qtd;
  // formata em R$
  const parcelaStr = parcela.toLocaleString('pt-BR', {minimumFractionDigits:2, maximumFractionDigits:2});
  document.getElementById('c_valorParcela').value = 'R$ ' + parcelaStr.replace('.', ',');
}

/* atualizar previews quando campos mudam */
const camposParaPreview = [
  'contratante','nacionalidade','estadoCivil','profissao','rg','cpfCnpj','endereco','numero','complemento','bairro','cep','email','data',
  'finalidadeProc',
  'c_motivoAcao','c_proLabore','c_valorPropositura','c_qtdParcelas','c_valorParcela','c_primeiroVencimento'
];
camposParaPreview.forEach(id => {
  const el = document.getElementById(id);
  if (!el) return;
  el.addEventListener('input', () => {
    renderPreviewProcuracao();
    renderPreviewDeclaracao();
    renderPreviewContrato();
  });
});

/* inicialização datas e finalidade padrão */
(function init(){
  const hoje = new Date();
  const tzOffset = hoje.getTimezoneOffset()*60000;
  const localISO = new Date(hoje - tzOffset).toISOString().split('T')[0];
  document.getElementById('data').value = localISO;

  let pv = new Date(hoje);
  pv.setDate(pv.getDate() + 10);
  document.getElementById('c_primeiroVencimento').value = new Date(pv - tzOffset).toISOString().split('T')[0];

  document.getElementById('finalidadeProc').value = "Ação judicial – Indenização por Danos Morais e Materiais";

  // Calcular valor da parcela inicial
  atualizarValorParcelaAutomatico();

  // executar previews iniciais
  renderPreviewProcuracao();
  renderPreviewDeclaracao();
  renderPreviewContrato();

  // carregar logo do site (se achar) - já definido, caso queira fallback pode trocar
  document.getElementById('pageLogo').src = siteLogoUrl;
})();

/* =======================
   Coletar dados para os templates
   ======================= */
function coletarDadosGlobais() {
  const endereco = document.getElementById('endereco').value || '';
  const numero = document.getElementById('numero').value || '';
  const complemento = document.getElementById('complemento').value || '';
  const bairro = document.getElementById('bairro').value || '';
  const cep = document.getElementById('cep').value || '';
  let enderecoCompleto = endereco;
  if (numero) enderecoCompleto += ', nº ' + numero;
  if (complemento) enderecoCompleto += ', ' + complemento;
  if (bairro) enderecoCompleto += ', ' + bairro;
  if (cep) enderecoCompleto += ', CEP ' + cep;

  return {
    contratante: document.getElementById('contratante').value || '',
    nacionalidade: document.getElementById('nacionalidade').value || '',
    estadoCivil: document.getElementById('estadoCivil').value || '',
    profissao: document.getElementById('profissao').value || '',
    rg: document.getElementById('rg').value || '',
    cpf: document.getElementById('cpfCnpj').value || '',
    email: document.getElementById('email').value || '',
    enderecoCompleto,
    data: document.getElementById('data').value || '',
    dataExtenso: dataPorExtenso(document.getElementById('data').value || ''),

    // contrato fields
    motivoAcao: document.getElementById('c_motivoAcao').value || '',
    proLabore: document.getElementById('c_proLabore').value || '30%',
    valorPropositura: document.getElementById('c_valorPropositura').value || '',
    qtdParcelas: parseInt(document.getElementById('c_qtdParcelas').value) || 1,
    valorParcela: document.getElementById('c_valorParcela').value || '',
    primeiroVencimento: document.getElementById('c_primeiroVencimento').value || '',
    finalidadeProc: document.getElementById('finalidadeProc').value || ''
  };
}

function dataPorExtenso(data) {
  if (!data) return "";
  const meses = ['janeiro','fevereiro','março','abril','maio','junho','julho','agosto','setembro','outubro','novembro','dezembro'];
  const d = new Date(data + "T00:00:00");
  if (isNaN(d)) return "";
  return `${d.getDate()} de ${meses[d.getMonth()]} de ${d.getFullYear()}`;
}

/* =======================
   Previews HTML
   ======================= */

function escapeHtml(s) { return (s||'').toString().replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

function renderPreviewProcuracao() {
  const d = coletarDadosGlobais();
  const content = `Eu, ${d.contratante.toUpperCase()}, ${d.nacionalidade}, ${d.estadoCivil}, ${d.profissao}, portador do RG nº ${d.rg || 'não informado'} e inscrito no CPF sob o nº ${d.cpfCnpj || 'não informado'}, residente e domiciliado na ${d.enderecoCompleto || 'não informado'}, endereço eletrônico: ${d.email || 'não informado'}, neste ato nomeio e constituo, como procuradora a advogada DÉBORA FERNANDA CASTILHO brasileira, união estável, inscrita na Ordem dos Advogados do Brasil - Seccional de São Paulo sob o nº 501311, com endereço eletrônico: debo_raubatuba@hotmail.com, com escritório profissional situado à Av. Dona Maria Alves, nº 438, Bairro Centro, Cidade de Ubatuba, Estado de São Paulo, CEP 11690-174, outorgando-lhe amplo poder para o foro em geral, com cláusula "ad judicia et extra", em qualquer Juízo, Instância, Tribunal ou Repartição Pública, podendo propor contra quem de direito, as ações competentes e defendê-lo nas contrárias, seguindo umas e outras, até final decisão, usando os recursos legais e acompanhando-os, conferindo-lhes ainda, poderes especiais para receber citação inicial, confessar, e conhecer a procedência do pedido, desistir, renunciar ao direito sobre que se funda a ação, transigir, firmar compromisso ou acordos, receber e dar quitação, podendo agir em Juízo ou fora dele, assim como substabelecer esta a outrem, com ou sem reservas de iguais poderes do presente mandato, para agir em conjunto ou separadamente com o substabelecido.`;
  
  const html = `<div style="text-align:center;font-weight:800;margin-bottom:8px">INSTRUMENTO PROCURATÓRIO</div>
  <div style="height:12px;"></div>
  <div style="text-align:justify;line-height:1.5;font-size:12px">${escapeHtml(content)}</div>
  <div style="margin-top:10px;font-weight:700">Finalidade: ${escapeHtml(d.finalidadeProc)}</div>
  <div style="text-align:right;margin-top:18px">Ubatuba, ${d.dataExtenso}</div>
  <div style="height:40px"></div>
  <div style="text-align:center">_________________________________________<br>${escapeHtml(d.contratante.toUpperCase())}</div>`;
  
  document.getElementById('preview-procuracao').innerHTML = html;
}

function renderPreviewDeclaracao() {
  const d = coletarDadosGlobais();
  const content = `${d.contratante.toUpperCase()}, ${d.nacionalidade}, ${d.estadoCivil}, ${d.profissao}, portador do RG nº ${d.rg || 'não informado'} e inscrito no CPF sob o nº ${d.cpfCnpj || 'não informado'}, residente e domiciliado na ${d.enderecoCompleto || 'não informado'}, endereço eletrônico: ${d.email || 'não informado'}, DECLARA para os devidos fins, ser pobre na acepção jurídica do termo, não possuindo meios econômicos para arcar com quaisquer custas processuais ou honorários relativos a presente contenda, sem que venha comprometer o sustento próprio e da sua família, necessitando, desta forma, dos benefícios da JUSTIÇA GRATUITA, nos termos do artigo 5º, inciso LXXIV e XXXV da Constituição Federal da República; outrossim, informa a declarante que se encontra na condição de isenção perante a Receita Federal do Brasil e, portanto, comprova seu estado de miserabilidade na forma do artigo 99, §3º da Lei Federal nº. 13.105/2015, com suas posteriores alterações.<br><br>
Ressaltando que no próprio sítio eletrônico da Secretaria da Receita Federal do Brasil informa que a Declaração de Isento deixou de existir, a partir do ano de 2008, sendo suficiente para comprovar tal condição a declaração escrita e assinada pelo próprio interessado, in verbis: "Informamos que a Declaração Anual de Isento (DAI) da Secretaria da Receita Federal do Brasil foi instituída com o objetivo de manter atualizado o Cadastro de Pessoas Físicas (CPF). Com a edição da Instrução Normativa RFB nº 864/2008, de 25 de julho de 2008, deixou de existir a Declaração Anual de Isento, a partir do ano de 2008. A isenção poderá ser comprovada mediante declaração escrita e assinada pelo próprio interessado, conforme previsto na Lei Federal nº. 13.105/2015".`;
  
  const html = `<div style="text-align:center;font-weight:800;margin-bottom:8px">D E C L A R A Ç Ã O</div>
  <div style="height:12px;"></div>
  <div style="text-align:justify;line-height:1.5;font-size:11px">${escapeHtml(content)}</div>
  <div style="text-align:right;margin-top:18px">Ubatuba, ${d.dataExtenso}</div>
  <div style="height:40px"></div>
  <div style="text-align:center">_________________________________________<br>${escapeHtml(d.contratante.toUpperCase())}</div>`;
  
  document.getElementById('preview-declaracao').innerHTML = html;
}

function renderPreviewContrato() {
  const d = coletarDadosGlobais();
  const parcelasTxt = gerarTextoParcelas(d.valorParcela, d.qtdParcelas, d.primeiroVencimento);
  
  const html = `<div style="text-align:center;font-weight:800;margin-bottom:8px">CONTRATO DE HONORÁRIOS ADVOCATÍCIOS</div>
  <div style="text-align:left;line-height:1.3;font-size:11px">
    <strong>DAS PARTES</strong><br>
    Contrato de Prestação de Serviço que fazem de um lado; CONTRATANTE ${escapeHtml(d.contratante.toUpperCase())}, ${escapeHtml(d.nacionalidade)}, ${escapeHtml(d.estadoCivil)}, ${escapeHtml(d.profissao)}, portador do RG nº ${escapeHtml(d.rg||'--')} e inscrito no CPF sob o nº ${escapeHtml(d.cpfCnpj||'--')}, residente e domiciliado na ${escapeHtml(d.enderecoCompleto||'--')}, endereço eletrônico: ${escapeHtml(d.email||'--')}, cidade de Ubatuba– SP.<br><br>
    O Contratante está ciente que foi devidamente instruído por sua advogada sobre seus direitos e sendo feito, optou em fazê-lo com a contratada, que por sua vez poderá substabelecer com ou sem reservas o presente para especialistas advogados, contabilistas e/ou contratados para o melhor suporte junto ao Contratante.<br><br>
    De outro lado; CONTRATADA DRA. DÉBORA FERNANDA CASTILHO brasileira, união estável, inscrita na Ordem dos Advogados do Brasil - Seccional de São Paulo sob o nº 501.311, com endereço eletrônico: debo_raubatuba@hotmail.com, com escritório profissional situado à Avenida Dona Maria Alves, nº 438, Sala 2,1° andar, Bairro Centro, CEP 11690-402, Cidade de Ubatuba, Estado de São Paulo, onde recebe informações e notificações.<br><br>
    
    <strong>OBJETO DO CONTRATO — CLÁUSULA 1</strong><br>
    O presente contrato tem por objetivo a prestação de serviços advocatícios para a defesa dos interesses do CONTRATANTE, por parte da Advogada contratada, para o fim de proceder na Ação de ${escapeHtml(d.motivoAcao || 'não especificado')}, nesta Comarca de Ubatuba/SP, pelas cláusulas e condições a seguir expostas:<br><br>
    
    <strong>DA FORMA DE COBRANÇA DOS HONORÁRIOS ADVOCATÍCIOS — CLÁUSULA 7</strong><br>
    O CONTRATANTE, como contraprestação aos serviços jurídicos prestados, pagará à CONTRATADA, a título de pro labore final, ${escapeHtml(d.proLabore || '30%')} do valor da causa, sendo essa procedente, e para a propositura da ação o valor de ${escapeHtml(d.valorPropositura || '')}${parcelasTxt ? ', feito os pagamentos à CONTRATADA pela chave pix mariajuliacastilho6@gmail.com, os quais serão pagos da seguinte forma; ' + escapeHtml(parcelasTxt) : ''}
  </div>
  <div style="text-align:right;margin-top:18px">Ubatuba, ${d.dataExtenso}</div>
  <div style="height:40px"></div>
  <div style="display:flex;justify-content:space-between">
    <div style="text-align:center">_________________________________________<br>${escapeHtml(d.contratante.toUpperCase())}</div>
    <div style="text-align:center">_________________________________________<br>DÉBORA FERNANDA CASTILHO<br>OAB/SP 501.311</div>
  </div>`;
  
  document.getElementById('preview-contrato').innerHTML = html;
}

/* Gera texto de parcelas semelhante ao comportamento anterior,
   cuidando para não gerar 'undefined' no valor por extenso */
function gerarTextoParcelas(valorParcela, qtdParcelas, primeiroVenc) {
  if (!valorParcela || !primeiroVenc) return '';
  
  const valorStr = valorParcela.replace(/[R$\s]/g,'');
  const qtd = parseInt(qtdParcelas) || 1;
  const d = new Date(primeiroVenc + 'T00:00:00');
  const datas = [];
  
  for (let i = 0; i < qtd; i++) {
    let n = new Date(d);
    n.setMonth(d.getMonth() + i);
    datas.push(n.toLocaleDateString('pt-BR'));
  }
  
  const ext = valorParaExtenso(valorParcela) || valorStr;
  
  if (qtd === 1) {
    return `${valorParcela} (${ext}) na data de ${datas[0]}`;
  } else {
    let txt = `${valorParcela} (${ext}) para inicio da ação, e mais ${qtd-1} parcelas no valor de ${valorParcela} (${ext}), com data para todo dia ${d.getDate()} de cada mês`;
    
    for (let i = 0; i < qtd; i++) {
      if (i === 0) {
        txt += `, sendo a primeira para ${datas[0]} (entrada)`;
      } else {
        txt += `, a ${i+1}ª para ${datas[i]}`;
      }
    }
    txt += '.';
    return txt;
  }
}

/* =======================
   PDFMake: modelos e geração
   ======================= */

const rodapeTexto = "______________________________________________________________________________________________________\nAvenida Dona Maria Alves, n° 438 – Loja 2 – 1° Andar, Centro Ubatuba/SP - CEP:11690-174 – BRASIL\nFones: (12) 9.9660-9801 · E-mail: debo_raubatuba@hotmail.com";

function montarHeader() {
  if (logoDataUrl) {
    return { 
      stack: [
        { 
          image: logoDataUrl, 
          width: 300, 
          alignment: 'center',
          margin: [0, 8, 0, 0]
        }
      ],
      margin: [40, 8, 40, 0]
    };
  } else {
    return { 
      text: 'DÉBORA CASTILHO — ADVOCACIA & ASSESSORIA JURÍDICA', 
      alignment: 'center', 
      margin: [40, 14, 40, 0], 
      bold: true 
    };
  }
}

function montarFooter() {
  return { columns: [{ text: rodapeTexto, alignment: 'center', fontSize: 9 }], margin: [40, 0, 40, 12] };
}

function docDefProcuracao(d) {
  const finalidade = d.finalidadeProc || '';
  
  const content = [
    { text: 'INSTRUMENTO PROCURATÓRIO', style: 'title' },
    { text: '\n\n' },
    { 
      text: [
        'Eu, ',
        { text: d.contratante.toUpperCase(), bold: true },
        `, ${d.nacionalidade}, ${d.estadoCivil}, ${d.profissao}, portador do RG nº ${d.rg || 'não informado'} e inscrito no CPF sob o nº ${d.cpfCnpj || 'não informado'}, residente e domiciliado na ${d.enderecoCompleto || 'não informado'}, endereço eletrônico: ${d.email || 'não informado'}, neste ato nomeio e constituo, como procuradora a advogada `,
        { text: 'DÉBORA FERNANDA CASTILHO', bold: true },
        ` brasileira, união estável, inscrita na Ordem dos Advogados do Brasil - Seccional de São Paulo sob o nº `,
        { text: '501311', bold: true },
        `, com endereço eletrônico: debo_raubatuba@hotmail.com, com escritório profissional situado à Av. Dona Maria Alves, nº 438, Bairro Centro, Cidade de Ubatuba, Estado de São Paulo, CEP 11690-174, outorgando-lhe amplo poder para o foro em geral, com cláusula "ad judicia et extra", em qualquer Juízo, Instância, Tribunal ou Repartição Pública, podendo propor contra quem de direito, as ações competentes e defendê-lo nas contrárias, seguindo umas e outras, até final decisão, usando os recursos legais e acompanhando-os, conferindo-lhes ainda, poderes especiais para receber citação inicial, confessar, e conhecer a procedência do pedido, desistir, renunciar ao direito sobre que se funda a ação, transigir, firmar compromisso ou acordos, receber e dar quitação, podendo agir em Juízo ou fora dele, assim como substabelecer esta a outrem, com ou sem reservas de iguais poderes do presente mandato, para agir em conjunto ou separadamente com o substabelecido.`
      ], 
      style: 'main', 
      alignment: 'justify' 
    },
    { text: '\n\n' }
  ];
  
  if (finalidade) {
    content.push({ text: `Finalidade: ${finalidade}`, style: 'main', alignment: 'left' });
    content.push({ text: '\n\n' });
  }
  
  content.push({ text: `Ubatuba, ${d.dataExtenso}.`, style: 'main', alignment: 'right' });
  content.push({ text: '\n\n\n' });
  content.push({ text: '_________________________________________', alignment: 'center' });
  content.push({ text: d.contratante.toUpperCase(), alignment: 'center', bold: true });

  return {
    pageSize: 'A4',
    pageMargins: [40, 80, 40, 80],
    header: montarHeader,
    footer: montarFooter,
    content,
    styles: { 
      title: { fontSize: 14, bold: true, alignment: 'center' }, 
      main: { fontSize: 11, lineHeight: 1.4 } 
    }
  };
}

function docDefDeclaracao(d) {
  const content = [
    { text: 'DECLARAÇÃO', style: 'title' },
    { text: '\n\n' },
    { 
      text: [
        { text: d.contratante.toUpperCase(), bold: true },
        `, ${d.nacionalidade}, ${d.estadoCivil}, ${d.profissao}, portador do RG nº ${d.rg || 'não informado'} e inscrito no CPF sob o nº ${d.cpfCnpj || 'não informado'}, residente e domiciliado na ${d.enderecoCompleto || 'não informado'}, endereço eletrônico: ${d.email || 'não informado'}, `,
        { text: 'DECLARA', bold: true },
        ` para os devidos fins, ser pobre na acepção jurídica do termo, não possuindo meios econômicos para arcar com quaisquer custas processuais ou honorários relativos a presente contenda, sem que venha comprometer o sustento próprio e da sua família, necessitando, desta forma, dos benefícios da `,
        { text: 'JUSTIÇA GRATUITA', bold: true },
        `, nos termos do artigo 5º, inciso LXXIV e XXXV da Constituição Federal da República; outrossim, informa a declarante que se encontra na condição de isenção perante a Receita Federal do Brasil e, portanto, comprova seu estado de miserabilidade na forma do artigo 99, §3º da Lei Federal nº. 13.105/2015, com suas posteriores alterações.`
      ], 
      style: 'main', 
      alignment: 'justify' 
    },
    { text: '\n\n' }, // Duas linhas abaixo
    { 
      text: `Ressaltando que no próprio sítio eletrônico da Secretaria da Receita Federal do Brasil informa que a Declaração de Isento deixou de existir, a partir do ano de 2008, sendo suficiente para comprovar tal condição a declaração escrita e assinada pelo próprio interessado, in verbis: "Informamos que a Declaração Anual de Isento (DAI) da Secretaria da Receita Federal do Brasil foi instituída com o objetivo de manter atualizado o Cadastro de Pessoas Físicas (CPF). Com a edição da Instrução Normativa RFB nº 864/2008, de 25 de julho de 2008, deixou de existir a Declaração Anual de Isento, a partir do ano de 2008. A isenção poderá ser comprovada mediante declaração escrita e assinada pelo próprio interessado, conforme previsto na Lei Federal nº. 13.105/2015".`,
      style: 'main', 
      alignment: 'justify' 
    },
    { text: '\n\n' },
    { text: `Ubatuba, ${d.dataExtenso}.`, style: 'main', alignment: 'right' },
    { text: '\n\n\n' },
    { text: '_________________________________________', alignment: 'center' },
    { text: d.contratante.toUpperCase(), alignment: 'center', bold: true }
  ];

  return {
    pageSize: 'A4',
    pageMargins: [40, 80, 40, 80],
    header: montarHeader,
    footer: montarFooter,
    content,
    styles: { 
      title: { fontSize: 14, bold: true, alignment: 'center' }, 
      main: { fontSize: 11, lineHeight: 1.4 }
    }
  };
}

function docDefContrato(d) {
  const parcelasTxt = gerarTextoParcelas(d.valorParcela, d.qtdParcelas, d.primeiroVencimento);
  const valorExt = (d.valorPropositura && valorParaExtenso(d.valorPropositura)) || d.valorPropositura || '';
  
  const content = [
    { text: 'CONTRATO DE HONORÁRIOS ADVOCATÍCIOS', style: 'title' },
    { text: '\n' },
    
    { text: 'DAS PARTES', bold: true },
    { text: '\n' },
    { text: { text: 'Contrato de Prestação de Serviço que fazem de um lado;', bold: true }, style: 'main', alignment: 'justify' },
    { text: { text: 'CONTRATANTE', bold: true }, style: 'main' },
{ 
  text: [
    { text: d.contratante.toUpperCase(), bold: true },
    `, ${d.nacionalidade}, ${d.estadoCivil}, ${d.profissao}, portador do RG nº ${d.rg || '--'} e inscrito no CPF sob o nº ${d.cpfCnpj || '--'}, residente e domiciliado na ${d.enderecoCompleto || '--'}, endereço eletrônico: ${d.email || '--'}, cidade de Ubatuba– SP.`
  ], 
  style: 'main', 
  alignment: 'justify' 
},
    { text: '\n' },
    { text: `O Contratante está ciente que foi devidamente instruído por sua advogada sobre seus direitos e sendo feito, optou em fazê-lo com a contratada, que por sua vez poderá substabelecer com ou sem reservas o presente para especialistas advogados, contabilistas e/ou contratados para o melhor suporte junto ao Contratante.`, style: 'main', alignment: 'justify' },
    { text: '\n' },
    { text: { text: 'CONTRATADA', bold: true }, style: 'main' },
{ 
  text: [
    { text: 'DRA. DÉBORA FERNANDA CASTILHO', bold: true },
    ` brasileira, união estável, inscrita na Ordem dos Advogados do Brasil - Seccional de São Paulo sob o nº 501.311, com endereço eletrônico: debo_raubatuba@hotmail.com, com escritório profissional situado à Avenida Dona Maria Alves, nº 438, Sala 2,1° andar, Bairro Centro, CEP 11690-402, Cidade de Ubatuba, Estado de São Paulo, onde recebe informações e notificações.`
  ], 
  style: 'main', 
  alignment: 'justify' 
},
    { text: '\n' },
    
    { text: 'OBJETO DO CONTRATO', bold: true },
    { text: '\n' },
    { text: 'CLÁUSULA 1', bold: true },
    { text: '\n' },
    { 
      text: [
        'O presente contrato tem por objetivo a prestação de serviços advocatícios para a defesa dos interesses do CONTRATANTE, por parte da Advogada contratada, para o fim de proceder na Ação de ',
        { text: d.motivoAcao || 'não especificado', bold: true },
        ', nesta Comarca de Ubatuba/SP, pelas cláusulas e condições a seguir expostas:'
      ], 
      style: 'main', 
      alignment: 'left' 
    },
    { text: '\n' },
    
    { text: 'DAS OBRIGAÇÕES DA CONTRATADA', bold: true },
    { text: '\n' },
    { text: 'CLÁUSULA 2', bold: true },
    { text: '\n' },
    { text: `A contratada obriga-se a prestar a contratante, nos termos da procuração outorgada, toda informação necessária, bem como acompanhar o processo judicial até o trâmite final, sempre aplicando todo seu conhecimento jurídico e empenho a fim de obter o melhor resultado.`, style: 'main', alignment: 'left' },
    { text: '\n' },
    { text: 'PARÁGRAFO ÚNICO: Interposição de recursos e demais procedimentos inerentes à atividade advocatícia, serão de faculdade exclusiva da advogada.', style: 'main', alignment: 'left' },
    { text: '\n' },
    
    { text: 'CLÁUSULA 3', bold: true },
    { text: '\n' },
    { text: `As atividades inclusas na prestação de serviço, objeto deste instrumento, são todas aquelas inerentes à profissão, quais sejam:`, style: 'main', alignment: 'left' },
    { text: 'a. Praticar quais atos e medidas necessárias inerentes à causa, em todas as repartições públicas Federal, Estadual e Municipal, bem como à órgãos a estes ligados, seja por delegação, concessão ou outros meios, bem como a de estabelecimentos particulares;', style: 'main', alignment: 'justify' },
    { text: 'b. Praticar todos os atos inerentes da Advocacia e aqueles constantes no Estatuto da Ordem dos Advogados do Brasil, bem como os especificados no instrumento procuratório.', style: 'main', alignment: 'left' },
    { text: '\n' },
    
    { text: 'DAS OBRIGAÇÕES DO CONTRATANTE', bold: true },
    { text: '\n' },
    { text: 'CLÁUSULA 4', bold: true },
    { text: '\n' },
    { text: `O contratante obriga-se a manter atualizado junto à contratada seus dados e meios de contato tais como e-mail, telefone fixo ou celular, endereço residencial.`, style: 'main', alignment: 'left' },
    { text: '\n' },
    { text: 'PARÁGRAFO PRIMEIRO: O contratante obriga-se ao pagamento dos serviços pactuados na forma proposta nas cláusulas 5 e seguintes, estando ciente que a inadimplência poderá acarretar em medidas de execução.', style: 'main', alignment: 'left' },
    { text: '\n' },
    
    { text: 'DAS DESPESAS', bold: true },
    { text: '\n' },
    { text: 'CLÁUSULA 5', bold: true },
    { text: '\n' },
    { text: `Todas as despesas efetuadas pela CONTRATADA, mesmo que indiretamente relacionadas com a sua atuação, incluindo-se cópias, digitalizações, envio de correspondência, emolumentos, viagens, estacionamento, custas, preparo e demais gastos de natureza diversa da verba honorária, ficarão a expensas do CONTRATANTE, desde que previamente por autorizadas.`, style: 'main', alignment: 'left' },
    { text: '\n' },
    
    { text: 'CLÁUSULA 6', bold: true },
    { text: '\n' },
    { text: `Todas as despesas serão acompanhadas de documento comprobatório, devidamente organizado pela CONTRATADA.`, style: 'main', alignment: 'justify' },
    { text: '\n' },
    
    { text: 'DA FORMA DE COBRANÇA DOS HONORÁRIOS ADVOCATÍCIOS', bold: true },
    { text: '\n' },
    { text: 'CLÁUSULA 7', bold: true },
    { text: '\n' },
    { 
      text: [
        'O CONTRATANTE, como contraprestação aos serviços jurídicos prestados, pagará à CONTRATADA, a título de pro labore final, ',
        { text: d.proLabore || '30%', bold: true },
        ' do valor da causa, sendo essa procedente, e para a propositura da ação o valor de ',
        { text: d.valorPropositura || '', bold: true },
        valorExt ? ' (' + valorExt + ')' : '',
        parcelasTxt ? ', feito os pagamentos à CONTRATADA pela chave pix mariajuliacastilho6@gmail.com, os quais serão pagos da seguinte forma; ' + parcelasTxt : ''
      ], 
      style: 'main', 
      alignment: 'left' 
    },
    { text: '\n' },
    { text: 'PARÁGRAFO ÚNICO: Estabelece o presente contrato, que no caso de não pagamento dos honorários devidos aos recursos, a CONTRATADA fica desobrigada de promovê-lo, ficando isento de toda e qualquer responsabilidade profissional ou pessoal.', style: 'main', alignment: 'left' },
    { text: '\n' },
    
    { text: 'CLÁUSULA 8', bold: true },
    { text: '\n' },
    { text: `Os honorários de sucumbência pertencem a CONTRATADA e não se confundem com os honorários contratuais aqui tratados.`, style: 'main', alignment: 'justify' },
    { text: '\n' },
    { text: 'PARÁGRAFO ÚNICO: Caso haja morte ou incapacidade civil da CONTRATADA, seus sucessores ou representante legal receberão os honorários na proporção do trabalho realizado.', style: 'main', alignment: 'left' },
    { text: '\n' },
    
    { text: 'CLÁUSULA 9', bold: true },
    { text: '\n' },
    { text: `As partes estabelecem que havendo atraso no pagamento dos honorários ensejará multa no valor de 2% (dois por cento) do valor devido e serão cobrados juros de mora na proporção de 3% (três por cento) ao mês, devidamente atualizados. Caso a mora seja superior a 30 (trinta) dias, salvo ajuste contrário, este contrato será rescindido de pleno direito, independentemente de qualquer medida judicial ou extrajudicial, considerando-se vencidas as demais obrigações vincendas, que serão exigidas de imediato.`, style: 'main', alignment: 'left' },
    { text: '\n' },
    
    { text: 'DA VIGÊNCIA E DA RESCISÃO', bold: true },
    { text: '\n' },
    { text: 'CLÁUSULA 10', bold: true },
    { text: '\n' },
    { text: `Este contrato tem vigência até o adimplemento das obrigações ajustadas e pode ser rescindido a qualquer tempo por qualquer das partes, mediante aviso prévio de 30 (trinta) dias, por escrito e com comprovante de entrega. Na hipótese de rescisão antecipada pelo CONTRATANTE, esta deverá pagar todos os valores pro labore pactuados neste contrato, bem como, para os valores pro êxito, um percentual correspondente à parcela do serviço que foi executada pela CONTRATADA. Este percentual nunca será inferior a cinquenta por cento do total. Em nenhum caso os valores já recebidos pelo CONTRATADO serão devidos o CONTRATANTE.`, style: 'main', alignment: 'left' },
    { text: '\n' },
    
    { text: 'DA RESPONSABILIDADE', bold: true },
    { text: '\n' },
    { text: 'CLÁUSULA 11', bold: true },
    { text: '\n' },
    { text: `A CONTRATADA não será responsabilizada por quaisquer danos que sobrevierem das demandas que patrocinar, cabendo-lhe tão somente o emprego diligente de seus conhecimentos, meios e técnicas para a defesa dos interesses do CONTRATANTE, inexistente qualquer garantia de resultado.`, style: 'main', alignment: 'left' },
    { text: '\n' },
    
    { text: 'CLÁUSULA 12', bold: true },
    { text: '\n' },
    { text: `A CONTRATADA não será responsabilizado acaso resultem danos por não tomar conhecimento de informações e documentos substanciais para a sua atividade ou em decorrência da impossibilidade de contato com o CONTRATANTE, que deverá manter atualizadas quaisquer informações relevantes para a demanda, bem como as informações cadastrais fornecidas por aquele.`, style: 'main', alignment: 'left' },
    { text: '\n' },
    
    { text: 'CLÁUSULA 13', bold: true },
    { text: '\n' },
    { text: `É obrigação do CONTRATANTE, sempre que solicitado, entregar, fornecer ou disponibilizar à CONTRATADA todos os documentos necessários, provas, informações e subsídios, em tempo hábil, para que este possa cumprir o objeto do presente contrato. Qualquer omissão ou negligência por parte do CONTRATANTE será de sua inteira responsabilidade, caso advenha algum prejuízo a seus interesses.`, style: 'main', alignment: 'left' },
    { text: '\n' },
    
    { text: 'DO FORO', bold: true },
    { text: '\n' },
    { text: 'CLÁUSULA 14', bold: true },
    { text: '\n' },
    { text: `Para dirimir quaisquer controvérsias oriundas deste contrato, as partes elegem o foro da comarca desta cidade.`, style: 'main', alignment: 'left' },
    { text: '\n' },
    
    { text: 'Por estarem assim justos e contratados, firmam o presente instrumento, em duas vias de igual teor.', style: 'main', alignment: 'left' },
    { text: '\n\n\n' },
    
    { text: `Ubatuba, ${d.dataExtenso}.`, alignment: 'right' },
    { text: '\n\n\n' },
    
    { 
      columns: [
        { 
          width: '50%', 
          stack: [
            { text: '_________________________________________', alignment: 'center' },
            { text: d.contratante.toUpperCase(), alignment: 'center', bold: true }
          ]
        },
        { 
          width: '50%', 
          stack: [
            { text: '_________________________________________', alignment: 'center' },
            { text: 'DÉBORA FERNANDA CASTILHO', alignment: 'center', bold: true },
            { text: 'OAB/SP 501.311', alignment: 'center' }
          ]
        }
      ]
    }
  ];

  return {
    pageSize: 'A4',
    pageMargins: [40, 80, 40, 80],
    header: montarHeader,
    footer: montarFooter,
    content,
    styles: { 
      title: { fontSize: 14, bold: true, alignment: 'center' }, 
      main: { fontSize: 11, lineHeight: 1.3 }
    }
  };
}

/* gera o PDF */
function gerarPDF(tipo) {
  if (!validarCamposObrigatorios(tipo)) {
    return;
  }
  
  const d = coletarDadosGlobais();
  let doc = null;
  if (tipo === 'procuracao') doc = docDefProcuracao(d);
  if (tipo === 'declaracao') doc = docDefDeclaracao(d);
  if (tipo === 'contrato') doc = docDefContrato(d);
  if (!doc) { alert('Tipo inválido'); return; }

  // caso logoDataUrl ainda não tenha sido carregada, tenta carregar antes
  if (!logoDataUrl) {
    loadHeaderLogo().then(() => {
      pdfMake.createPdf(doc).download('documento_' + tipo + '.pdf');
    });
  } else {
    pdfMake.createPdf(doc).download('documento_' + tipo + '.pdf');
  }
}

/* =======================
   Botões de ação
   ======================= */

document.getElementById('pdfProcuracaoBtn').addEventListener('click', () => { renderPreviewProcuracao(); gerarPDF('procuracao'); });
document.getElementById('pdfDeclaracaoBtn').addEventListener('click', () => { renderPreviewDeclaracao(); gerarPDF('declaracao'); });
document.getElementById('pdfContratoBtn').addEventListener('click', () => { renderPreviewContrato(); gerarPDF('contrato'); });

document.getElementById('salvarDadosBtn').addEventListener('click', () => {
  // validação básica (mesmo comportamento anterior)
  const obrig = ['contratante','profissao','cpfCnpj','endereco','numero','bairro','cep','data'];
  for (const id of obrig) {
    const el = document.getElementById(id);
    if (!el || !el.value.trim()) { alert('Preencha o campo obrigatório: ' + id); el && el.focus(); return; }
  }
  alert('Informações salvas localmente no formulário. Você pode gerar os documentos nas abas correspondentes.');
});

/* helpers: render preview initially */
renderPreviewProcuracao();
renderPreviewDeclaracao();
renderPreviewContrato();
</script>
</body>
</html>
